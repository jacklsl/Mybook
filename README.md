基于UnrealEngine的“极速跑酷”

游戏的设计与实现

Design and Implementation of The SpeedParkour

Game Base on UnrealEngine

基于UnrealEngine的“极速跑酷”

游戏的设计与实现

\[摘 要\] 伴随着互联网和硬件设备的发展，游戏的种类越来越多样化，游戏的趣味性越来越好，特别是在虚拟现实技术的兴起使得游戏的开发进入一个全新的阶段。本文以UnrealEngine4为游戏引擎，采用蓝图和UnrealEngine4的游戏框架等技术，设计和开发了一款“极速跑酷”2D的跨平台游戏。用户可以通过两个按钮能够控制和操作游戏中的人物动作、吃掉物品，得到分数等，同时该游戏采用卡通式的风格。游戏在制作过程中，充分考虑内存问题，使得游戏可以很好的运行。

\[关键词\] 虚幻4引擎 ；虚拟现实；蓝图；跨平台游戏

Design and Implementation of The SpeedParkour

Game Base on UnrealEngine

**Abstract: **Along with the development of Internet and hardware equipment, games are becoming more and more diversified and interesting, especially with the rise of virtual reality technology, it brings the game development into a new stage. In this paper, it takes UnrealEngine4 as the game engine and completes a game of "Speed Parkour" which is an cross platform 2D game by using blueprint and UnrealEngine4's game framework. Users can operate character movement, control the person to eat items and get scores through tow buttons. The game uses cartoon style and considers the memory problem, so that the game can be a good run in the production process.

**Key words: **UnrealEngine4；virtual reality；blueprint；cross platform game

# 

# 2 游戏开发环境和关键技术

“极速跑酷”的设计与实现，需要多方面知识和技术的结合。这就要求我们必须充分了解游戏的开发环境和关键的技术。

## 2.1 游戏开发环境

表2-1游戏开发环境

| 操作系统 | Windows 7 |
| --- | --- |
| 平台 | Windows 7 |
| 开发环境 | UnrealEngine4 |
| 开发语言 | Blueprint，C++ |
| 测试 | PC |

## 2.2 关键技术

在本节，将对基于UnrealEngine4的游戏开发所涉及到的技术进行介绍。

### 2.2.1 “蓝图”简介

蓝图是一种可视化的游戏了脚本。开发人员通过对蓝图节点的操作，实现游戏的复杂功能。蓝图脚本系统，非常的强大，而且操作简便，不需要开发人员进行语言编程，实现游戏的复杂功能。

蓝图可以创建几乎游戏所需的各种元素，并且可以进行修改。

Games（游戏）：由游戏规则，游戏关卡，游戏人物，游戏界面，游戏玩家等组成。

Players（玩家）：由PlayerController，模型，碰撞体等组成。

Cameras（相机）：由Camera在关卡中进行实例化。

Input（输入） ：在项目设置中通过输入的设置，创建输入事件。

Items（道具） ：武器、法术、掉落物、触发器等。

Environments（环境） ： 创建物品，并生成物品。

\(1\)"蓝图"概述

Blueprints（蓝图）在虚幻引擎中是一种，特殊类型的资源，提供了一个简单，直观的编程界面。他为游戏开发人员提供了一种快速创建和迭代游戏的工具。蓝图摒弃传统编程模式，通过可视化的编程，实现游戏功能。

\(2\)"蓝图"工作原理

蓝图的编程是可视化的编程。蓝图是游戏的可视化脚本。游戏开发者，通过使用连线将Node（节点），Event（事件），Function（函数），Variable（变量）连接起来，实现某种功能。通过这种简单的编程方法，开发者能创建复杂的游戏功能。

\(3\)常见蓝图类型

最常见的 蓝图 类型是 Level Blueprints（关卡蓝图） 和 Class Blueprints（类蓝图） 。

1.Level Blueprints（关卡蓝图）

关卡蓝图是和关卡紧密联系的。每个关卡都有其自己的关卡蓝图，他可以对游戏关卡中的所有事物进行引用和操作，并且可使用Matinee Actor控制过场动画，管理关卡动态加载等一系列操作。对于关卡中的实例化类，关卡蓝图可以获取实例化了的引用，调用实例化类的事件以及变量，进而控制实例化类做出某些改变。

2.Class Blueprints（类蓝图）

类蓝图，非常类似于我们编程语言中的类，通过对类蓝图中的事件，函数，变量的使用和创建，得到我们所需要的类蓝图，通过实例化被使用。类蓝图作为交互式资源可以被广泛应用。游戏中的所有事物都可以使用类蓝图对其进行操作。

### 2.2.2 编程语言--Blueprint和C++

UnrealEngine引擎前几代，都是使用脚本沙盒语言——UnrealScript来进行编程的通过简单的GamePlay模式进行编程。进而减少对C++的使用，来开发游戏。

随着引擎的发展，脚本编程已经不能够满足，游戏开发的要求，并且阻碍了游戏的发展。因此，到2011年，UnrealEngine4游戏引擎使用C++进行编程。采用C++编程的具体原因如下：

\(1\) 随着游戏引擎的不断成长，完整的沙盒功能的脚本，会使游戏引擎变得复杂和庞大。这样将不利于游戏引擎的成长。

\(2\) 由于脚本语言的惯用法与对应的 C++ 模板，在表达方式和语意有很大的差异，使得C++与脚本之间的通讯变得很复杂。脚本的接口的扩展，使得C++与脚本之间的交流变得更加困难，这样不利于游戏的开发和游戏的更新，会对后期的游戏维护和更新带来毁灭性的灾难。

\(3\) 脚本语言的使用，导致脚本与代码切换，浪费了大量的时间，使得游戏执行变得缓慢，拖累了游戏的开发。

\(4\) 由于脚本调试工具和C++调试工具是独立的和不兼容的。因为我们无法跟踪C++程序，这样，当游戏发生错误时，我们很难判断，是脚本的原因或是C++程序的原因。个给游戏的开发有带来了一个难题。

综上所述，Epic最终采用了纯C++，作为游戏开发的编程语言。这样带来和很多的方便，让开发者从那些无聊而繁琐的地方，得到解放，使他们更加专注游戏的开发。游戏脚本的废除，让开发者更加专注与C++游戏的修改和扩展，使游戏开发的效率大大的提高了。

并不是说C++是一个很理想的游戏编程语言。比起UnrealScript，C\#，JavaScript，它有很多的复杂性，危险性。但反过来换一种方式说，C++更加强大。

Epic采用纯C++,是进行过多方面的考虑的。准确来所，C++并不是一种很好的游戏编程语言。C++的灵活性很好，但却也有很大的复杂性，这样在游戏开发的时候危险性却也很大。在C++编程时，开发者必须更加的谨慎。

C++的强大，可以让开发者在游戏开发时，有很大的灵活性，并且可以打破很多编程时的限制。通过底层代码的修改，开发者们甚至可以和操作系统层，高级第三方库进行打交道。

蓝图可以继承C++类，从而使得程序员可以在代码中创建新的游戏性类，而关卡设计人员可以使用蓝图来继承该类并对其进行修改。通过对C++类的编译可获得蓝图类。

### 2.2.3 Gameplay框架

游戏的框架由不同的部分进行相互间的交流和沟通而构成。游戏框架各部分负责不的功能，他们既分工又合作完成游戏的运行，就像工厂里的工人一样。游戏的架构就是通过分工合作来构建起来的。如PlayerController，它只负责游戏人物的控制，但却也和GameMode等进行合作。

游戏人物的控制是由PlayerController来实现。PlayerController可以拥有一个 Pawn 。 Pawn 是玩家在游戏中的物理表示。PlayerController负责玩家的行为。Pawn即为玩家在游戏中的人物形象。玩家为Pawn的子类。他继承Pawn。

Pawn 可以包含其自己的运动规则和其他游戏逻辑，但是该功能也可以包含在 Controller 类中。Controller有两种类型：PlayerController；AIController。PlayerController是一种玩家控制器。AIController是由计算机控制的控制器。PlayerController通过玩家的外部输入，来控制Pawn的各种行为。AIController通过各种预先设置的规则，来控制Pawn的各种行为。这就是我们所说的人工智能。游戏中的各种Boss通过AIController的控制，使游戏变得更加的智能化，赋予了他们思考的能力。Boss通过AIController的控制来实现Boss的巡视，追击，攻击，逃跑，空闲等状态的切换。

### 2.2.4 基本架构元素

基本架构元素：GameMode\(游戏模式\)；Pawn（兵）；Controller（控制器）；Camera（摄像机）；User Interfaces\(用户界面\) & HUD（平视显示信息）。

（1）GameMode\(游戏模式\)

游戏作为一个虚拟的世界，存在着自身的一些规则。通过这些规则的制定，游戏才能有序的运行，否者游戏就会陷入混乱。不同的游戏有着他们各自的游戏规则，同时他们也有一些相同的规则如：

限制玩家的数量；人物死亡后重生；游戏的暂停；物理效果的作用。

这些规则使用，限制玩家的某些行为，但对游戏的构建和运行起到了很大的的作用。这些规则除了保护玩家外，使得游戏的运行更加的贴近现实。

处理游戏类型信息有两种：GameMode 和 GameState。

“AGameMode”类定义所玩的游戏，并执行游戏规则。任何的游戏规则都必须添加到“AGameMode”类的子类中。玩家的重生，拥有的道具，游戏的时间，游戏的结束等都属于GameMode。通过GameMode中添加的规则，玩家将会依据这些规则来操作游戏。同添加新的游戏规则到GameMode中开发者，可以对游戏进行扩展。游戏可以有很多的游戏类型，这些游戏类型都是“AGameMode”类的子类，但是，在特定的时间只能使用一种游戏类型。通“UGameEngine::LoadMap\(\)”函数初始化一个游戏等级时都会实例化一个 GameMode Actor。该 Actor 定义的游戏类型将被用于该等级所持续的时间。

（2）Pawn\(兵\)

Pawn与游戏中的Actor十分类似，但是Pawn可以接受游戏玩家的输入，进而被玩家所控制，并且可通过玩家的输入，执行不同的动作。而Actor却不具备这种性质。所以在创建事物的时候，谨慎选择Pawn和Actor。

Pawn类是可由玩家或 AI 控制的。Pawn是玩家或游戏人工智能实体在游戏世界中的代表。Pawn的实体的外表，代表了游戏玩家和人工智能的外表。玩家和人工智能通过Pawn的实体，来与游戏世界进行交流。在遵循整个游戏世界的规则下，Pawn实体接受玩家和人工智能的指令，完成特定的动作。可以说Pawn是玩家和人工智能与游戏世界沟通的重要桥梁。Character 是一种特殊类型的能走动的 Pawn。Character（角色）是类人的Pawn它本身默认具有一个用于碰撞的CapsuleComponent（胶囊体组件）和CharacterMovementComponent （角色运动组件）。它可以进行基本的拟人运动，它可以平滑地在网络上复制运动，并且它具有一些动画相关的功能。

默认情况下，每个控制器在任何特定时间只控制一个 Pawn。此外，在游戏中生成的 Pawn不被控制器自动控制。

在蓝图中，使用SetActorLocation可以控制Pawn实体在游戏中的位置，通过SetActorLocation节点可以实现Pawn实体先某一方向进行移动。如果遇到游戏中的实体SetActorLocation节点将会失效。

\(3\)Controller\(控制器\)

Controller控制Pawn和Actor两种类型。Controller有两种模式：AICondtroller（人工智能控制器）和PlayerController（玩家控制器）控制器与Pawn的关系是一对一的。

Controller（控制器）不是物理性存在的，在游戏世界中不存在实体，只用于控制游戏世界中Pawn或Actor的行为。玩家通过PlayerController（玩家控制器）控制Pawn实现Pawn的各种行为。AIController（人工智能控制器）通过AI发出指令，控制Pawn实现Pawn的各种行为。控制器使用 Possess 函数控制Pawn,使用 Unpossess函数放弃控制Pawn。

PlayerController（玩家控制器）通过玩家的输入执行相应的行为（如跳跃，滑动，暂停等）。行为的执行对象一般为Pawn和Camera（相机）等。Pawn和Camer（相机）自身必须具有某些动作。

AICondtroller（玩家控制器）主要通过和游戏世界的交流而做出相应的反应（如巡视，追击，攻击，逃跑等）。PlayerController（玩家控制器）和AIController（人工智能控制器）的区别在于：PlayerController（玩家控制器）是被动接受输入执行动作，AIController（人工智能控制器）是主动根据世界环境，主动执行动作。

\(4\) Camera\(摄像机\)

游戏玩家通过Camera（摄像机）来观看游戏世界的，游戏视角即为玩家视角。因此Camera（摄像机）只和游戏玩家有关。所以游戏Camera\(摄像机\)是被PlayerController（玩家控制器）所控制的。

PlayerCameraManager（玩家摄像机管理器） 类是管理游戏摄像机的。ViewTarget 结构在 PlayerCameraManager 中定义ViewTarget向PlayerCameraManager提供理想的视角。PlayerCameraManager（玩家摄像机管理器）通过ViewTarget来调整摄像机视角，位置等其他设置。

\(5\)User Interfaces\(用户界面\) & HUD（平视显示信息）

游戏界面是游戏玩家与游戏世界进行交流重要方式。玩家通过界面来显示游戏中的人物状态等一系列信息，同时通过游戏界面的一些操作来影响游戏人物以及游戏的一些状态。 游戏界面一般由两个主要部分组成： 平头显示信息\(HUD\)和 菜单或用户界面\(UI\)。

\(HUD\)\(平视显示信息\)主要显示游戏的状态以及一些重要信息。\(HUD\)\(平视显示信息\)主要是向玩家来显示游戏的一些必要信息（如人物的血量，游戏时间，游戏得分）。\(HUD\)\(平视显示信息\)主要用来显示信息，无法对游戏产生影响。这是\(HUD\)\(平视显示信息\)与其他游戏界面的明显区别。

用户界面\(UI\)是用于玩家和游戏世界进行交互的。不同于\(HUD\)\(平视显示信息\)，用户界面\(UI\)可以触发游戏人物动作的。用户界面\(UI\)与\(HUD\)\(平视显示信息\)一样都是以平面的形式，在屏幕上显示。玩家与游戏的交流主要是，通过用户界面\(UI\)实现的。用户界面\(UI\)是通过一些标准控件和自定义控件所组成的。通过一些控件布局和程序的操作，玩家就可以和游戏进行沟通和交流了。好的游戏界面布局和整个游戏界面的系统的设计，能够很好的帮助玩家进行操作。

## 2.3 本章小结

本章主要讲解了游戏开发的环境和游戏关键的开发技术。详细讲解了开发所需的编程语言和游戏框架。

# 3 游戏需求分析

游戏开发前，首先需要注意游戏的特性和在各个平台注意的事项。得到游行的需求，尤其是功能需求，以便明确游戏开发目标。

## 3.1 游戏功能描述

随着硬件设备性能的提高，使得运行大型游戏有了可能，但是，不同硬件有其各自的极限，上述情况，使得我们的游戏都一定的局限性。一款好的游戏，必须要尽量能够在多个硬件设备上进行运行，这就需要我们最大限度的提高游戏的运行效率减低运行内存，以上所述的特性要求开发人员在逻辑设计时一定严谨，开发人员必须对游戏的特点有清晰的认识和明确的逻辑设计思路。否则游戏内存过大，在性能较低的设备上将会造成死机等一系列问题。

以手机为例，众所周知手机内存是非常有限的，所以节约内存的思想必须贯穿整个游戏设计过程。图片资源和音频资源过大，有可能用尽手机内存资源，所以在搜集资源的时，尽量选择容量小的。在游戏中，对已经不需要的资源，要尽快销毁来释放内存。

随着手机的普及，手机游戏将会越来越流行。日常繁琐和紧张的工作，让人们的神经越来越紧绷，人们需要一种方式来释放自身的压力。手机休闲类游戏，恰恰可以使人们在休息时释放压力。休闲类游戏不需要太过集中精力于游戏中，使玩家在一个轻松愉悦的环境下，进行游戏，进而释放压力。

“极速跑酷”正是基于这个原因进行开发的。为游戏的轻松性，游戏背景音乐尽量选择舒缓平静的音乐。为了使玩家能够轻松进行游戏，操作不宜太复杂。为了增加游戏的趣味性，游戏将加入宠物。卡通类的宠物作为游戏的调味剂增加了游戏的趣味性。同时，在界面设计上尽量卡通式设计，满足人们心中的童心，让人暂时忘记现实世界的压力。为了满足上述要求，游戏界面的风格尽量卡通，游戏的操作简单，游戏的声音尽量舒缓，游戏加入宠物。

## 3.2 游戏功能与非功能需求分析

通过图3-1 我们可知“极速跑酷”由五大部分组成。他们分别是：游戏界面，关卡创建，宠物伴随，声效系统，人物控制。

\(1\) 界面设计

界面设计按照卡通式的界面进行游戏。包括，欢迎界面.登录界面，主界面，设置界面，完成界面，失败界面，战斗界面等。

\(2\) 关卡设计

地板以及背景按照不同的速度从右到左进行移动。关卡在右边产生，并在左边进行销毁。这样便能降低游戏内存。

\(3\) 游戏宠物

除了增加游戏的趣味性，还会根据状态选择伴随和帮助用户吃掉物品。

\(4\)声效系统

包括：背景音乐，UMG界面的声效；等一些声音。

\(5\)人物的控制

通过外部的输入事件，人物进行相应的动作反应，同时吃掉关卡创建的物品。

图3–1 “极速跑酷”游戏的用例图

### 3.2.1 功能需求

结合本人在跑酷类游戏上经验和体会，本科题中游戏的基本需求和功能大体上可以总结如下：

\(1\)界面的创建：完成游戏的登录界面，主界面，战斗界面，结束界面等界面的布局和功能的实现。

\(2\)关卡的创建：创建一个无限循环的场景，并使场景由右向左移动。

\(3\)人物的设置：通过相应不同的事件人物将会做出不同的动作。

\(4\)游戏记时：记录游戏过程的时间。

\(5\)游戏声音：在游戏运行时添加相应的音乐。

\(6\)关卡的设计：根据游戏时的关卡，实现不同的效果和功能，例如随着关卡的增加，图片采用不同的移动方案和布局等。用户可手动选择游戏的开始关卡。

\(7\) 游戏规则介绍：详细向用户介绍本游戏的游戏规则，帮助用户熟悉本游戏的玩法。

\(8\)人物宠物：关卡开始后有不同种类的宠物伴随游戏人物行动。

### 3.2.2 非功能需求

\(1\) 性能要求

“极速跑酷”属于小型的单机游戏，所以要求安装后的整个游戏程序都不应占据太多的SD卡容量，最多不要超过1MB。还有与游戏过程相关的数据存储文件也要尽可能的小。在游戏运行的过程中，对于用户的相关操作要做到及时响应，处理时间最好不要超过1秒。

\(2\) 质量要求

整个游戏开发结束后，要生成游戏安装包。整体的游戏效果要求简单易懂。游戏的安装、卸载以及移植要求操作方便。游戏默认安装到SD卡中。

\(3\) 游戏界面要求

为了更好展现游戏效果，游戏界面要求水平布局，全屏显示。根据本游戏的功能需求，游戏界面主要分为三类。

欢迎界面：游戏的开始界面，要有时长合适的开场动画，动画过后进入游戏菜单界面。

游戏菜单界面：提供相应选项供用户选择，例如游戏的各项设置等等。

游戏操作界面：用户进行游戏时的界面，展现游戏的背景、计时器、统计得分等内容，提供暂停及离开游戏等选项让用户操作。

\(4\) 游戏点击操作方式

现在的手机大部分都是触屏手机，游戏进行点击操作。

## 3.3 本章小结

本章内容先从“极速跑酷”的特性入手，分析得出了游戏开发过程中必须注意的一些逻辑要点和手机设备的硬件特性限制。然后又结合自己以往的游戏经验，总结得出了手机“极速跑酷”游戏的功能需求和非功能需求，进而使游戏的实现目标更加明确。

# 4 游戏的总体设计

经过上一章的需求分析工作，已经确定了本游戏的各方面需求，接下来对游戏的总体设计方向进行概述，划分并设计游戏的功能模块。

## 4.1 游戏总体技术方案

由图4–1可了解整体的技术路线。UnrealEngine4游戏引擎，是在操作系统下进行运行的。蓝图通过调用由UnrealEngine4引擎使用C++封装的节点，来实现不同的游戏功能。

图4–1“极速跑酷”游戏的技术路线图

## 4.2 游戏功能模块的划分

上述的总体方案从整体上分析了本游戏需要用到的技术支持。根据之前的分析结果，考虑本游戏进行时的呈现的功能不同，还需要划分出进行游戏所需的主要功能模块，以便于高效地完成以后的详细分析工作 为极速跑酷的总体功能模块图。

图4–2极速跑酷游戏的模块设计方案

根据图4-2，我们划分类总体的功能模块，对以上模块我们需要进行更加详细的设计与分析。各个模块的功能设计如下：

\(1\)界面实现

该模块负责在游戏操作运行时，人与机器的交互。将不同的控件显示在屏幕上，响应用户的点击操作，并触发事件。以供用户进行游戏操作。

\(2\)声效实现

通过对游戏不同位置添加声音实现音效。

\(3\)人物控制

该模块实现人物的动画播放，通过不同的触发事件，播放相应的人物动画，该部分是游戏的核心部分。

\(4\)关卡的创建

该部分实现场景的无限循环。通过不断的进行物品的创建和销毁，来使场景无限的进行循环。

\(5\)宠物伴随

该模块实现了人工智能的部分，增加了游戏的趣味性，同时也是核心部分。宠物是伴随人物进行运动的。

\(6\)物品创建

该模块实现了障碍物以及物品的创建，游戏通过触发碰撞的方式来随机产生新的物品和障碍物。

## 4.3 本章小结

本章的主要内容是对本课题进行总体设计，制定了总体设计方案，列举出了本游戏的核心技术问题，然后围绕这些问题细分出了本游戏的重要功能模块，并对各个功能模块进行了逐一设计。

# 5 游戏详细设计

本章将采用面向对象的思想进行游戏的框架设计，并详细阐述游戏界面和各个功能模块的设计思路，为游戏的实现做好充分的准备工作。

## 5.1 游戏框架设计

本游戏按照一定的模式进行架构，通过Gameplay框架架构“极速跑酷”。一个游戏由GameMode和GameState构成。加入游戏的人类玩家同PlayerController相关联。

图5–1极速跑酷游戏的游戏框架方案

## 5.2 游戏声音的设计

游戏中的声音可以增加游戏趣味性，极速跑酷游戏中的声音效果可以分为三类。首先当用户点击开始游戏的按钮进入游戏操作界面时，要有背景音乐的循环播放，直到游戏退出。

## 5.3 游戏核心程序的设计

游戏的核心程序的设计包括：人物程序的设计；宠物程序的设计；关卡程序的设计。其中人物程序控制人物行为，宠物程序控制宠物伴随，关卡程序创建关卡。

### 5.3.1 人物程序设计

人物的控制是通过战斗界面的点击，进行实现人物的一段跳和二段跳以及侧滑。点击“跳跃”控制人物的。游戏通过输入事件进行事件的触发。

图5–2极速跑酷游戏的人物程序流程图

### 5.3.2 宠物程序设计

（1）宠物的核心功能在于伴随人物行动，程序通过Tick事件根据不同的状态设置宠物的不同位置。

图5–3极速跑酷游戏的宠物伴随行动流程图

\(2\) 程序通过Tick事件进行触发，使叶子移动到宠物的位置。

图5–4极速跑酷游戏的叶子移动到宠物位置流程图

### 5.3.3 关卡程序设计

\(1\)关卡程序主要负责关卡背景和地板的产生。通过触发装置产生地板和背景。

图5–5极速跑酷游戏的关卡的产生流程图

\(2\) 关卡的移动根据移动的组件的速度,由右向左进行移动。

图5–6极速跑酷游戏的关卡移动流程图

## 5.4 游戏界面的设计

游戏界面是用户与本游戏交互的桥梁，漂亮的界面效果定会赢得用户的赞赏并提升游戏自身的价值。根据之前的界面要求，结合游戏功能在各类界面中的功能体现，可以做出如下的界面设计。

\(1\)欢迎界面：如图5–7所示，欢迎界面是由一段视频的播放来实现欢迎用户的。

\(2\)游戏登录：如图5–8所示，游戏登录界面有多部分组成。界面顶部中间，为人物的头像。其左右两边，共同组成了“极速跑酷”的字样。人物的头像下方，通过星星的标记对用户的等级进行标记。界面中间，是用户名和密码的输入。界面的底部，是游戏的“登录”按钮和“注册”按钮。“登录”按钮上方，为游戏的自动登。

\(3\)注册界面：如图5–9所示，界面顶部显示“注册”字样。右上方。为游戏的“关闭”按钮。界面中间，为注册游戏需要的信息。他们的两边，为宠物动画。地步为“注册”按钮。

\(4\)主界面：如图5–10所示，有四个按钮组成。“设置游戏”，“关于游戏”，“退出游戏”，“开始游戏”

\(5\)游戏设置界面：如图5–11所示，主要设置游戏声音和昵称等。

\(6\)关于游戏界面：如图5–12所示，主要介绍游戏的规则。

\(7\)战斗界面：如图5–13所示，与人物进行交互操作，并显示数量，分数，时间等信息。

\(8\)结束界面：如图5–14所示，当游戏完成时显示。

### 5.4.1 游戏欢迎界面

本游戏开始运行时，第一个界面就是欢迎界面，欢迎界面是一段Logo的视频。

图5–7极速跑酷游戏的欢迎界面

### 5.4.2 登录界面

本游戏为用户提供了一个登录界面，该界面需要用户输入用户名和密码进行登录。

图5–8极速跑酷游戏的登录界面

### 5.4.3 注册界面

点击登录界面的“注册”按钮界面跳转的注册界面，将注册的信息进行存储。

图5–9极速跑酷游戏的注册界面

### 5.4.4 主菜单界面

在欢迎界面的logo动画之后显示本游戏的主菜单界面。

图5–10极速跑酷游戏的主界面

### 5.4.5 游戏设置界面

对游戏的界面主要对游戏的声音和昵称记性设置。

图5–11极速跑酷游戏的设置界面

### 5.4.6 关于游戏界面

本游戏界面最要介绍游戏的规则。

图5–12极速跑酷游戏的关于游戏界面

### 5.4.7 游戏战斗界面

游戏战斗界面，与人物进行交互操作，并显示数量，分数，时间等信息。

图5–13极速跑酷游戏的登录界面

### 5.4.8 游戏结束界面

当游戏成功时，出现该界面。

图5–14极速跑酷游戏的胜利界面

## 5.5 本章小结

本章是本论文的核心部分，首先根据之前的需求分析和总体设计，采用Gameplay框架方法对极速跑酷游戏的框架进行了设计。接着阐述了游戏界面的详细设计内容，给出了各个界面的布局示意图。然后按照之前的功能模块划分，详细描述了各个模块的设计过程。其中游戏核心程序是论文的核心技术，因此在本章编写中绘制了大量相关的图形、流程图，以及引用了多张图片，并进行了必要的文字说明，以便于读者理解本章中的设计思想。

# 6 游戏实现

到此为止，本游戏的设计工作已基本完成。根据本游戏所需的开发环境，本章将先对游戏开发前需做的一些准备工作进行阐述，然后再按照第六章的设计思路，描述对游戏中的类及各个功能模块的具体实现过程。

## 6.1 游戏开发前准备工作

在为 Android 开发前，我们首先要安装 Android SDK，该 SDK 为发布到 android 提供开发所需的程序和代码，下面来介绍如何安装该软件。

如果您是从 GitHub 下载的虚幻 4，那再运行 Android Works 的安装文件前您需要先完成以下步骤。 并且以下步骤对下载虚幻 4 的源码版本，无论是 Windows 还是 Mac 的电脑，都是适用的。 如果您是通过启动器下载的预编译版本，那么久可以跳过这个步骤，直接开始安装 Android Works。

当虚幻 4 从 Github 上下载并解压后，运行文件 Setup.bat 来下载其他所需要的文件，其中包含 Android Works 的安装文件。

在 Setup.bat 运行完成后，找到 Android Works 的安装文件，并跟随下面的说明。

如果已经安装安卓 SDK，但丢失了环境变量，则可跳过以下所有步骤，只需使用编辑器中的 Edit Menu -&gt; Project Settings -&gt; Android SDK 属性指向安装位置。

\(1\)导航到 TADP 安装文件夹：

表6-1 TADP 安装文件夹

| 安装类型 | 位置 |
| --- | --- |
| 二进制 | \[EngineInstallLocation\]\Unreal Engine\[EngineVersion\]\Engine\Extras\Android |
| GitHub | \[EngineSyncLocation\UE4\Engine\Extras\Android |

如果您是从 GitHub 下载的虚幻 4，那再运行 Android Works 的安装文件前您需要先完成以下步骤。 并且以下步骤对下载虚幻 4 的源码版本，无论是 Windows 还是 Mac 的电脑，都是适用的。 如果您是通过启动器下载的预编译版本，那么久可以跳过这个步骤，直接开始安装 Android Works。

当虚幻 4 从 Github 上下载并解压后，运行文件 Setup.bat 来下载其他所需要的文件，其中包含 Android Works 的安装文件。

在 Setup.bat 运行完成后，找到 Android Works 的安装文件，并跟随下面的说明。

\(2\) Double-click AndroidWorks-1R1-windows.exe。

\(3\)单击Next。

\(4\)单击Next。

\(5\)选择一个文件夹来下载并安装 Android Works，并在完成后单击 Next 按钮。

\(6\)确认您要安装的是 AndroidWorks1R1 并点击 Next。

\(7\) 点击单选框，对授权协议没有异议的话选择 Accept All，并单击 Accept 按钮。

\(8\) 会弹出一个新窗口，显示 Android Works 工具下载和安装的进度。

\(9\) 当所有的工具都下载安装完成后，在接下来的窗口中点击 OK 继续安装进程。

\(10\) 这时可以点击 Finish 来完成 Android Works 的安装。

\(11\)最后，点击 Yes 重启电脑。

## 6.2 游戏中类的实现

根据游戏的设计，可将游戏游戏负责游戏功能的主要类做出如下的实现。

\(1\) 界面类的父类均是 UserWidget类，这些类实现游戏主要界面的显示和逻辑处理功能。这些类包括：登录界面；主界面；设置界面；完成界面等，他们各自实现了不同的功能。

\(2\) 人物类的父类是Pawn类，这些类实现类接收玩家的输入，并作出相应的动作。

人物类主要实现了，一段跳，二段跳，跑步等动作。

\(3\) 物品类的父类是Actor类，这些类实现了物品的移动和物品的排布方式。

## 6.3 游戏记时的实现

游戏通过获取GameTimeinSeconds节点获取初始化时的时间，通过TimeLeft的值与GameTimeinSeconds的值相加得到StartTime就是倒计时时间。

图6-1类的初始化

游戏通过tick事件获取分钟和秒的时间。

图6-2类的时间的获取和显示

## 6.4 游戏核心程序的实现

游戏核心程序包括了：人物程序，宠物程序，关卡程序。

人物程序主要控制人物的动作。通过游戏界面的“滑动”按钮和“跳跃”按钮。控制人物的滑动，一段跳和二段跳。宠物程序主要控制宠物的伴随。通过不同状态，改变伴随状态。关卡程序主要负责创建游戏的关卡，负责游戏的循环场景。

### 6.4.1 人物程序的实现

如图6-3所示，人物的控制是通过战斗界面的点击，进行实现人物的一段跳和二段跳以及侧滑。点击“跳跃”控制人物的。游戏通过输入事件进行事件的触发。

玩家通过控制“跳跃”按钮实现人物的一段跳和二段跳。

图6-3人物程序跳跃的实现

如图6-4所示，玩家通过按下“滑动”按钮人物实现滑动，释放“滑动”按钮人物恢复奔跑。

图6-4人物程序滑动的实现

### 6.4.2 宠物程序的实现

如图6-5所示，程序通过Tick事件获取不同状态下的位置通过Lerp节点改变宠物位置。

图6-5宠物伴随的实现

### 6.4.3 关卡程序的实现

如图6-6所示，程序通过触发事件进行关卡的创建。当碰撞器碰撞，获取对方组件名为“End”时，在碰撞的位置，通过Select节点随机产生新的物品。

图6-6关卡创建的实现

## 6.5 游戏其他功能的实现

如图6-7所示，战斗界面的“滑动”按钮按下事件，被触发后，通过获取游戏人物，调用人物的滑动事件。

图6-7战斗界面的“滑动”按钮按下事件实现

如图6-8所示，战斗界面的“滑动”按钮释放事件，被触发后，通过获取游戏人物，调用人物的跑步事件。

图6-8战斗界面的“滑动”按钮释放事件实现

如图6-9所示，战斗界面的“跳跃”按钮事件，被触发后，通过获取游戏人物，调用人物的跳跃事件。

图6-9斗界面的“跳跃”按钮事件实现

如图6-10所示，战斗界面的“暂停”按钮事件，被触发后，通过SetGamePaused节点暂停游戏，再次被触发，游戏继续。

图6-10战斗界面的“暂停”按钮事件实现

## 6.6 本章小结

本章内容主要介绍了本游戏的实现过程。首先简述了游戏开发前所需要做的准备工作。接着是本章的重点内容，根据上一章的设计要领，阐述了游戏中的主要类和各个功能模块的实现，最后概述了游戏中的其他功能的实现过程。

