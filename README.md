基于UnrealEngine的“极速跑酷”

游戏的设计与实现

Design and Implementation of The SpeedParkour

Game Base on UnrealEngine

基于UnrealEngine的“极速跑酷”

游戏的设计与实现

\[摘 要\] 伴随着互联网和硬件设备的发展，游戏的种类越来越多样化，游戏的趣味性越来越好，特别是在虚拟现实技术的兴起使得游戏的开发进入一个全新的阶段。本文以UnrealEngine4为游戏引擎，采用蓝图和UnrealEngine4的游戏框架等技术，设计和开发了一款“极速跑酷”2D的跨平台游戏。用户可以通过两个按钮能够控制和操作游戏中的人物动作、吃掉物品，得到分数等，同时该游戏采用卡通式的风格。游戏在制作过程中，充分考虑内存问题，使得游戏可以很好的运行。

\[关键词\] 虚幻4引擎 ；虚拟现实；蓝图；跨平台游戏

Design and Implementation of The SpeedParkour

Game Base on UnrealEngine

**Abstract: **Along with the development of Internet and hardware equipment, games are becoming more and more diversified and interesting, especially with the rise of virtual reality technology, it brings the game development into a new stage. In this paper, it takes UnrealEngine4 as the game engine and completes a game of "Speed Parkour" which is an cross platform 2D game by using blueprint and UnrealEngine4's game framework. Users can operate character movement, control the person to eat items and get scores through tow buttons. The game uses cartoon style and considers the memory problem, so that the game can be a good run in the production process.

**Key words: **UnrealEngine4；virtual reality；blueprint；cross platform game

# 

# 

# 

# 4 游戏的总体设计

经过上一章的需求分析工作，已经确定了本游戏的各方面需求，接下来对游戏的总体设计方向进行概述，划分并设计游戏的功能模块。

## 4.1 游戏总体技术方案

由图4–1可了解整体的技术路线。UnrealEngine4游戏引擎，是在操作系统下进行运行的。蓝图通过调用由UnrealEngine4引擎使用C++封装的节点，来实现不同的游戏功能。

图4–1“极速跑酷”游戏的技术路线图

## 4.2 游戏功能模块的划分

上述的总体方案从整体上分析了本游戏需要用到的技术支持。根据之前的分析结果，考虑本游戏进行时的呈现的功能不同，还需要划分出进行游戏所需的主要功能模块，以便于高效地完成以后的详细分析工作 为极速跑酷的总体功能模块图。

图4–2极速跑酷游戏的模块设计方案

根据图4-2，我们划分类总体的功能模块，对以上模块我们需要进行更加详细的设计与分析。各个模块的功能设计如下：

\(1\)界面实现

该模块负责在游戏操作运行时，人与机器的交互。将不同的控件显示在屏幕上，响应用户的点击操作，并触发事件。以供用户进行游戏操作。

\(2\)声效实现

通过对游戏不同位置添加声音实现音效。

\(3\)人物控制

该模块实现人物的动画播放，通过不同的触发事件，播放相应的人物动画，该部分是游戏的核心部分。

\(4\)关卡的创建

该部分实现场景的无限循环。通过不断的进行物品的创建和销毁，来使场景无限的进行循环。

\(5\)宠物伴随

该模块实现了人工智能的部分，增加了游戏的趣味性，同时也是核心部分。宠物是伴随人物进行运动的。

\(6\)物品创建

该模块实现了障碍物以及物品的创建，游戏通过触发碰撞的方式来随机产生新的物品和障碍物。

## 4.3 本章小结

本章的主要内容是对本课题进行总体设计，制定了总体设计方案，列举出了本游戏的核心技术问题，然后围绕这些问题细分出了本游戏的重要功能模块，并对各个功能模块进行了逐一设计。

# 5 游戏详细设计

本章将采用面向对象的思想进行游戏的框架设计，并详细阐述游戏界面和各个功能模块的设计思路，为游戏的实现做好充分的准备工作。

## 5.1 游戏框架设计

本游戏按照一定的模式进行架构，通过Gameplay框架架构“极速跑酷”。一个游戏由GameMode和GameState构成。加入游戏的人类玩家同PlayerController相关联。

图5–1极速跑酷游戏的游戏框架方案

## 5.2 游戏声音的设计

游戏中的声音可以增加游戏趣味性，极速跑酷游戏中的声音效果可以分为三类。首先当用户点击开始游戏的按钮进入游戏操作界面时，要有背景音乐的循环播放，直到游戏退出。

## 5.3 游戏核心程序的设计

游戏的核心程序的设计包括：人物程序的设计；宠物程序的设计；关卡程序的设计。其中人物程序控制人物行为，宠物程序控制宠物伴随，关卡程序创建关卡。

### 5.3.1 人物程序设计

人物的控制是通过战斗界面的点击，进行实现人物的一段跳和二段跳以及侧滑。点击“跳跃”控制人物的。游戏通过输入事件进行事件的触发。

图5–2极速跑酷游戏的人物程序流程图

### 5.3.2 宠物程序设计

（1）宠物的核心功能在于伴随人物行动，程序通过Tick事件根据不同的状态设置宠物的不同位置。

图5–3极速跑酷游戏的宠物伴随行动流程图

\(2\) 程序通过Tick事件进行触发，使叶子移动到宠物的位置。

图5–4极速跑酷游戏的叶子移动到宠物位置流程图

### 5.3.3 关卡程序设计

\(1\)关卡程序主要负责关卡背景和地板的产生。通过触发装置产生地板和背景。

图5–5极速跑酷游戏的关卡的产生流程图

\(2\) 关卡的移动根据移动的组件的速度,由右向左进行移动。

图5–6极速跑酷游戏的关卡移动流程图

## 5.4 游戏界面的设计

游戏界面是用户与本游戏交互的桥梁，漂亮的界面效果定会赢得用户的赞赏并提升游戏自身的价值。根据之前的界面要求，结合游戏功能在各类界面中的功能体现，可以做出如下的界面设计。

\(1\)欢迎界面：如图5–7所示，欢迎界面是由一段视频的播放来实现欢迎用户的。

\(2\)游戏登录：如图5–8所示，游戏登录界面有多部分组成。界面顶部中间，为人物的头像。其左右两边，共同组成了“极速跑酷”的字样。人物的头像下方，通过星星的标记对用户的等级进行标记。界面中间，是用户名和密码的输入。界面的底部，是游戏的“登录”按钮和“注册”按钮。“登录”按钮上方，为游戏的自动登。

\(3\)注册界面：如图5–9所示，界面顶部显示“注册”字样。右上方。为游戏的“关闭”按钮。界面中间，为注册游戏需要的信息。他们的两边，为宠物动画。地步为“注册”按钮。

\(4\)主界面：如图5–10所示，有四个按钮组成。“设置游戏”，“关于游戏”，“退出游戏”，“开始游戏”

\(5\)游戏设置界面：如图5–11所示，主要设置游戏声音和昵称等。

\(6\)关于游戏界面：如图5–12所示，主要介绍游戏的规则。

\(7\)战斗界面：如图5–13所示，与人物进行交互操作，并显示数量，分数，时间等信息。

\(8\)结束界面：如图5–14所示，当游戏完成时显示。

### 5.4.1 游戏欢迎界面

本游戏开始运行时，第一个界面就是欢迎界面，欢迎界面是一段Logo的视频。

图5–7极速跑酷游戏的欢迎界面

### 5.4.2 登录界面

本游戏为用户提供了一个登录界面，该界面需要用户输入用户名和密码进行登录。

图5–8极速跑酷游戏的登录界面

### 5.4.3 注册界面

点击登录界面的“注册”按钮界面跳转的注册界面，将注册的信息进行存储。

图5–9极速跑酷游戏的注册界面

### 5.4.4 主菜单界面

在欢迎界面的logo动画之后显示本游戏的主菜单界面。

图5–10极速跑酷游戏的主界面

### 5.4.5 游戏设置界面

对游戏的界面主要对游戏的声音和昵称记性设置。

图5–11极速跑酷游戏的设置界面

### 5.4.6 关于游戏界面

本游戏界面最要介绍游戏的规则。

图5–12极速跑酷游戏的关于游戏界面

### 5.4.7 游戏战斗界面

游戏战斗界面，与人物进行交互操作，并显示数量，分数，时间等信息。

图5–13极速跑酷游戏的登录界面

### 5.4.8 游戏结束界面

当游戏成功时，出现该界面。

图5–14极速跑酷游戏的胜利界面

## 5.5 本章小结

本章是本论文的核心部分，首先根据之前的需求分析和总体设计，采用Gameplay框架方法对极速跑酷游戏的框架进行了设计。接着阐述了游戏界面的详细设计内容，给出了各个界面的布局示意图。然后按照之前的功能模块划分，详细描述了各个模块的设计过程。其中游戏核心程序是论文的核心技术，因此在本章编写中绘制了大量相关的图形、流程图，以及引用了多张图片，并进行了必要的文字说明，以便于读者理解本章中的设计思想。

# 6 游戏实现

到此为止，本游戏的设计工作已基本完成。根据本游戏所需的开发环境，本章将先对游戏开发前需做的一些准备工作进行阐述，然后再按照第六章的设计思路，描述对游戏中的类及各个功能模块的具体实现过程。

## 6.1 游戏开发前准备工作

在为 Android 开发前，我们首先要安装 Android SDK，该 SDK 为发布到 android 提供开发所需的程序和代码，下面来介绍如何安装该软件。

如果您是从 GitHub 下载的虚幻 4，那再运行 Android Works 的安装文件前您需要先完成以下步骤。 并且以下步骤对下载虚幻 4 的源码版本，无论是 Windows 还是 Mac 的电脑，都是适用的。 如果您是通过启动器下载的预编译版本，那么久可以跳过这个步骤，直接开始安装 Android Works。

当虚幻 4 从 Github 上下载并解压后，运行文件 Setup.bat 来下载其他所需要的文件，其中包含 Android Works 的安装文件。

在 Setup.bat 运行完成后，找到 Android Works 的安装文件，并跟随下面的说明。

如果已经安装安卓 SDK，但丢失了环境变量，则可跳过以下所有步骤，只需使用编辑器中的 Edit Menu -&gt; Project Settings -&gt; Android SDK 属性指向安装位置。

\(1\)导航到 TADP 安装文件夹：

表6-1 TADP 安装文件夹

| 安装类型 | 位置 |
| --- | --- |
| 二进制 | \[EngineInstallLocation\]\Unreal Engine\[EngineVersion\]\Engine\Extras\Android |
| GitHub | \[EngineSyncLocation\UE4\Engine\Extras\Android |

如果您是从 GitHub 下载的虚幻 4，那再运行 Android Works 的安装文件前您需要先完成以下步骤。 并且以下步骤对下载虚幻 4 的源码版本，无论是 Windows 还是 Mac 的电脑，都是适用的。 如果您是通过启动器下载的预编译版本，那么久可以跳过这个步骤，直接开始安装 Android Works。

当虚幻 4 从 Github 上下载并解压后，运行文件 Setup.bat 来下载其他所需要的文件，其中包含 Android Works 的安装文件。

在 Setup.bat 运行完成后，找到 Android Works 的安装文件，并跟随下面的说明。

\(2\) Double-click AndroidWorks-1R1-windows.exe。

\(3\)单击Next。

\(4\)单击Next。

\(5\)选择一个文件夹来下载并安装 Android Works，并在完成后单击 Next 按钮。

\(6\)确认您要安装的是 AndroidWorks1R1 并点击 Next。

\(7\) 点击单选框，对授权协议没有异议的话选择 Accept All，并单击 Accept 按钮。

\(8\) 会弹出一个新窗口，显示 Android Works 工具下载和安装的进度。

\(9\) 当所有的工具都下载安装完成后，在接下来的窗口中点击 OK 继续安装进程。

\(10\) 这时可以点击 Finish 来完成 Android Works 的安装。

\(11\)最后，点击 Yes 重启电脑。

## 6.2 游戏中类的实现

根据游戏的设计，可将游戏游戏负责游戏功能的主要类做出如下的实现。

\(1\) 界面类的父类均是 UserWidget类，这些类实现游戏主要界面的显示和逻辑处理功能。这些类包括：登录界面；主界面；设置界面；完成界面等，他们各自实现了不同的功能。

\(2\) 人物类的父类是Pawn类，这些类实现类接收玩家的输入，并作出相应的动作。

人物类主要实现了，一段跳，二段跳，跑步等动作。

\(3\) 物品类的父类是Actor类，这些类实现了物品的移动和物品的排布方式。

## 6.3 游戏记时的实现

游戏通过获取GameTimeinSeconds节点获取初始化时的时间，通过TimeLeft的值与GameTimeinSeconds的值相加得到StartTime就是倒计时时间。

图6-1类的初始化

游戏通过tick事件获取分钟和秒的时间。

图6-2类的时间的获取和显示

## 6.4 游戏核心程序的实现

游戏核心程序包括了：人物程序，宠物程序，关卡程序。

人物程序主要控制人物的动作。通过游戏界面的“滑动”按钮和“跳跃”按钮。控制人物的滑动，一段跳和二段跳。宠物程序主要控制宠物的伴随。通过不同状态，改变伴随状态。关卡程序主要负责创建游戏的关卡，负责游戏的循环场景。

### 6.4.1 人物程序的实现

如图6-3所示，人物的控制是通过战斗界面的点击，进行实现人物的一段跳和二段跳以及侧滑。点击“跳跃”控制人物的。游戏通过输入事件进行事件的触发。

玩家通过控制“跳跃”按钮实现人物的一段跳和二段跳。

图6-3人物程序跳跃的实现

如图6-4所示，玩家通过按下“滑动”按钮人物实现滑动，释放“滑动”按钮人物恢复奔跑。

图6-4人物程序滑动的实现

### 6.4.2 宠物程序的实现

如图6-5所示，程序通过Tick事件获取不同状态下的位置通过Lerp节点改变宠物位置。

图6-5宠物伴随的实现

### 6.4.3 关卡程序的实现

如图6-6所示，程序通过触发事件进行关卡的创建。当碰撞器碰撞，获取对方组件名为“End”时，在碰撞的位置，通过Select节点随机产生新的物品。

图6-6关卡创建的实现

## 6.5 游戏其他功能的实现

如图6-7所示，战斗界面的“滑动”按钮按下事件，被触发后，通过获取游戏人物，调用人物的滑动事件。

图6-7战斗界面的“滑动”按钮按下事件实现

如图6-8所示，战斗界面的“滑动”按钮释放事件，被触发后，通过获取游戏人物，调用人物的跑步事件。

图6-8战斗界面的“滑动”按钮释放事件实现

如图6-9所示，战斗界面的“跳跃”按钮事件，被触发后，通过获取游戏人物，调用人物的跳跃事件。

图6-9斗界面的“跳跃”按钮事件实现

如图6-10所示，战斗界面的“暂停”按钮事件，被触发后，通过SetGamePaused节点暂停游戏，再次被触发，游戏继续。

图6-10战斗界面的“暂停”按钮事件实现

## 6.6 本章小结

本章内容主要介绍了本游戏的实现过程。首先简述了游戏开发前所需要做的准备工作。接着是本章的重点内容，根据上一章的设计要领，阐述了游戏中的主要类和各个功能模块的实现，最后概述了游戏中的其他功能的实现过程。

